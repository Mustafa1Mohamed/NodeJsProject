<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>My Profile</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
    />
    <style>
      :root {
        --baby-bg: #f7fbff; /* خلفية فاتحة */
        --baby-card: #eaf5ff; /* كرت بيبي بلو */
        --baby-border: #d5eaff; /* حدود ناعمة */
        --baby-primary: #56a9ff; /* زر أساسي */
        --baby-primary-hover: #3d97fb;
        --baby-outline: #56a9ff; /* زر إطار */
        --text-main: #0b2239; /* نص داكن لطيف */
      }
      body {
        background: linear-gradient(180deg, #ffffff, var(--baby-bg));
        color: var(--text-main);
        min-height: 100vh;
      }
      .page-title {
        color: var(--text-main);
        font-weight: 700;
        letter-spacing: 0.2px;
      }
      .card-baby {
        background: var(--baby-card);
        border: 1px solid var(--baby-border);
        border-radius: 14px;
      }
      .btn-baby {
        background: var(--baby-primary);
        border-color: var(--baby-primary);
        color: #fff;
      }
      .btn-baby:hover {
        background: var(--baby-primary-hover);
        border-color: var(--baby-primary-hover);
        color: #fff;
      }
      .btn-outline-baby {
        color: var(--baby-outline);
        border-color: var(--baby-outline);
        background: #fff;
      }
      .btn-outline-baby:hover {
        color: #fff;
        background: var(--baby-outline);
        border-color: var(--baby-outline);
      }
      .avatar {
        border-radius: 12px;
        border: 2px solid var(--baby-border);
        background: #fff;
      }
      .badge-baby {
        background: var(--baby-primary);
      }
    </style>
  </head>
  <body>
    <div class="container py-4">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h1 class="m-0 page-title">My Profile</h1>
        <button class="btn btn-outline-baby" onclick="logout()">Logout</button>
      </div>

      <div id="card" class="card card-baby p-3 shadow-sm">
        <div class="d-flex align-items-center">
          <img
            id="avatar"
            src="https://via.placeholder.com/120"
            alt="Avatar"
            class="avatar me-3"
            width="120"
            height="120"
          />
          <div>
            <h3 id="name" class="mb-1">...</h3>
            <p id="email" class="mb-1">...</p>
            <span class="badge badge-baby" id="role">user</span>
          </div>
        </div>
        <div class="mt-3">
          <a class="btn btn-baby" href="./edit.html"
            >Edit Profile</a
          >
        </div>
      </div>
    </div>

    <script>
      // const API = location.origin; // e.g. http://localhost:3000
      const token = localStorage.getItem("token");

      function logout() {
        localStorage.removeItem("token");
        window.location.href = "../auth/login/login.html";
      }

      if (!token) {
        window.location.href = "../auth/login/login.html";
      }

      fetch("http://localhost:3000/me", {
        headers: { Authorization: "Bearer " + token },
      })
        .then((r) => (r.ok ? r.json() : Promise.reject(r)))
        .then((u) => {
          document.getElementById("name").textContent = u.name || "";
          document.getElementById("email").textContent = u.email || "";
          document.getElementById("role").textContent = u.role || "user";
          document.getElementById("avatar").src =
            u.photoURL || "https://via.placeholder.com/120";
        })
        .catch(async (err) => {
          let msg = "Error loading profile";
          try {
            msg = (await err.json()).msg || msg;
          } catch {}
          alert(msg);
          if (err.status === 401) logout();
        });
    </script>
  </body>
</html>
