<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>My Profile</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" />
</head>
<body class="bg-dark text-light">
<div class="container py-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h1 class="m-0">My Profile</h1>
    <button class="btn btn-outline-light" onclick="logout()">Logout</button>
  </div>

  <div id="card" class="card bg-secondary p-3">
    <img id="avatar" src="" alt="avatar" style="width:120px;height:120px;object-fit:cover;border-radius:50%" />
    <div class="mt-3">
      <p><b>Name:</b> <span id="name"></span></p>
      <p><b>Email:</b> <span id="email"></span></p>
      <p><b>Role:</b> <span id="role"></span></p>
    </div>
    <a href="/views/profile/edit.html" class="btn btn-success mt-2">Edit Profile</a>
  </div>
</div>

<script>
  const API = location.origin; // http://localhost:3000
  const token = localStorage.getItem("token");

  if (!token) {
    window.location.href = "/views/auth/login/login.html";
  }

  fetch(API + "/me", {
    headers: { Authorization: "Bearer " + token }
  })
    .then(r => r.ok ? r.json() : Promise.reject(r))
    .then(u => {
      document.getElementById("name").textContent = u.name || "";
      document.getElementById("email").textContent = u.email || "";
      document.getElementById("role").textContent = u.role || "user";
      document.getElementById("avatar").src = u.photoURL || "https://via.placeholder.com/120";
    })
    .catch(async (e) => {
      try { alert(await e.text()); } catch {}
      if (e.status === 401) window.location.href = "/views/auth/login/login.html";
    });

  function logout(){
    localStorage.removeItem("token");
    window.location.href = "../auth/login/login.html";
  }
</script>

</body>
</html>
